/**
 * @license jCanvas Handles v14.03.09
 * Copyright 2013 Caleb Evans
 * Released under the MIT license
 */
!function(e){function n(n){var r=n._method;return r===e.fn.drawRect||r===e.fn.drawEllipse||r===e.fn.drawImage}function r(n){var r=n._method;return r===e.fn.drawLine||r===e.fn.drawQuadratic||r===e.fn.drawBezier}function a(n,r,a,t){var i=e.extend({cursors:{mouseover:"grab",mousedown:"grabbing",mouseup:"grab"}},r.handle,{layer:!0,draggable:!0,x:r[a],y:r[t],_parent:r,_xProp:a,_yProp:t,fromCenter:!0,drag:function(e){var n=e._parent;n[e._xProp]=e.x-n.x,n[e._yProp]=e.y-n.y,s(n)}});n.draw(i),r._handles.push(n.getLayer(-1))}function t(n,r,a,t){var i,d;-1===a&&-1===t||1===a&&1===t?d="nwse-resize":0!==a||-1!==t&&1!==t?-1!==a&&1!==a||0!==t?(1===a&&-1===t||-1===a&&1===t)&&(d="nesw-resize"):d="ew-resize":d="ns-resize",i=e.extend({cursors:{mouseover:d}},r.handle,{layer:!0,draggable:!0,x:r.x+a*r.width/2,y:r.y+t*r.height/2,_parent:r,_px:a,_py:t,fromCenter:!0,dragstart:function(n){e(this).triggerLayerEvent(n._parent,"resizestart")},drag:function(n){var r=n._parent;r.resizeFromCenter?(r.width+=n.dx*n._px*2,r.height+=n.dy*n._py*2,r.constrainProportions&&(0===n._py?r.height=r.width/r.aspectRatio:r.width=r.height*r.aspectRatio)):(r.width+=n.dx*n._px,r.height+=n.dy*n._py,r.constrainProportions&&(0===n._py?r.height=r.width/r.aspectRatio:(r.width=r.height*r.aspectRatio,n.dx=n.dy*r.aspectRatio*n._py*n._px)),0!==n._px&&(r.x+=n.dx/2),0!==n._py&&(r.y+=n.dy/2)),g(r),e(this).triggerLayerEvent(r,"resize")},dragstop:function(n){var r=n._parent;e(this).triggerLayerEvent(r,"resizestop")},dragcancel:function(n){var r=n._parent;e(this).triggerLayerEvent(r,"resizecancel")}}),n.draw(i),r._handles.push(n.getLayer(-1))}function i(e,n){var r=n.handlePlacement;null===n.aspectRatio&&0!==n.height&&(n.aspectRatio=n.width/n.height),("corners"===r||"both"===r)&&(t(e,n,-1,-1),t(e,n,1,-1),t(e,n,1,1),t(e,n,-1,1)),("sides"===r||"both"===r)&&(t(e,n,0,-1),t(e,n,1,0),t(e,n,0,1),t(e,n,-1,0)),n.guide&&o(e,n)}function d(e){var n=e._guide;n&&(n.x=e.x,n.y=e.y,n.width=e.width,n.height=e.height,n.fromCenter=e.fromCenter)}function o(n,r){var a,t;a=e.extend({},r.guide,{layer:!0,draggable:!1,type:"rectangle",handle:null}),n.addLayer(a),t=n.getLayer(-1),r._guide=t,n.moveLayer(t,-r._handles.length-1),d(r)}function h(e,n){var r,t,i,d;for(r in n)n.hasOwnProperty(r)&&(t=n[r],null!==r.match(/c?x(\d+)/gi)&&(i=r,d=r.replace("x","y"),a(e,n,i,d)));n.guide&&l(e,n)}function s(n){var r=n._handles,a=n._guides,t,i,d,o;if(n._method===e.fn.drawQuadratic){if(r)for(d=n._guide,i=0;i<r.length;i+=1)t=n._handles[i],d["x"+(i+1)]=t.x,d["y"+(i+1)]=t.y}else if(n._method===e.fn.drawBezier&&a)for(o=0;o<a.length;o+=1)for(d=a[o],r=d._handles,i=0;i<r.length;i+=1)t=r[i],d["x"+(i+1)]=t.x,d["y"+(i+1)]=t.y}function l(n,r){var a=r._handles,t,i,d,o,h,l,g;if(g=e.extend({},r.guide,{layer:!0,draggable:!1,type:"line"}),r._method===e.fn.drawQuadratic)n.addLayer(g),r._guide=n.getLayer(-1),n.moveLayer(r._guide,-a.length-1);else if(r._method===e.fn.drawBezier)for(r._guides=[],h=0;h<a.length;h+=1)o=a[h],i=a[h+1],t=a[h-1],d=null,void 0!==i?0===o._xProp.indexOf("x")&&0===i._xProp.indexOf("cx")&&(d=i):void 0!==t&&0===t._xProp.indexOf("cx")&&0===o._xProp.indexOf("x")&&(d=t),null!==d&&(n.addLayer(g),l=n.getLayer(-1),l._handles=[o,d],r._guides.push(l),n.moveLayer(l,-a.length-1));s(r)}function g(e){var n,r;if(e._handles)for(r=0;r<e._handles.length;r+=1)n=e._handles[r],n.x=e.x+e.width/2*n._px,n.y=e.y+e.height/2*n._py;d(e)}function p(e){var n=e._handles,r,a;if(n)for(a=0;a<n.length;a+=1)r=n[a],r.x=e[r._xProp]+e.x,r.y=e[r._yProp]+e.y;s(e)}function _(a){var t=e(a.canvas);void 0===a._handles&&(a._handles=[]),n(a)?(i(t,a),a.drag=g):r(a)&&(h(t,a),a.drag=p)}e.extend(e.jCanvas.defaults,{handle:null,guide:null,aspectRatio:null,resizeFromCenter:!0,constrainProportions:!1,handlePlacement:"corners",minWidth:0,minHeight:0}),e.jCanvas(),e.extend(e.jCanvas.eventHooks,{add:function(e){e.handle&&_(e)},change:function(a,t){var i,d,o;if(t.handle)_(a);else if(null===t.handle&&(i=e(this),a._handles)){for(o=0;o<a._handles.length;o+=1)d=a._handles[o],i.removeLayer(d);a._handles.length=0}n(a)?(void 0!==t.width||void 0!==t.height)&&g(a):r(a)&&p(a)},animate:function(e,a){n(e)?("width"===a.prop||"height"===a.prop||"x"===a.prop||"y"===a.prop)&&g(e):r(e)&&null!==a.prop.match(/^c?(x|y)(\d+)/gi)&&p(e)}})}(jQuery);