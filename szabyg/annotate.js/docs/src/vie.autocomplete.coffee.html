<!DOCTYPE html><html><head><title>vie.autocomplete.coffee</title><meta http-equiv="Content-Type" content="text/html" charset="UTF-8"><link rel="stylesheet" media="all" href="../docco.css"></head><body><div id="container"><div id="background"></div><div id="jump_to">Jump To &hellip;<div id="jump_wrapper"><div id="jump_page"><a href="../index.html" class="source"><span class="file_name">README</span></a><a href="../src/annotate.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">annotate.coffee</span></a><a href="../src/annotationInteraction.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">annotationInteraction.coffee</span></a><a href="../src/annotationSelector.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">annotationSelector.coffee</span></a><a href="../src/stanbolEnhancementAPI.coffee.html" class="source "><span class="base_path">src / </span><span class="file_name">stanbolEnhancementAPI.coffee</span></a><a href="../src/vie.autocomplete.coffee.html" class="source selected"><span class="base_path">src / </span><span class="file_name">vie.autocomplete.coffee</span></a></div></div></div><table cellpadding="0" cellspacing="0"><thead><tr><th class="docs"><h1>vie.autocomplete.coffee</h1><div class="filepath">src/</div></th><th class="code"></th></tr></thead><tbody><tr id="section-1"><td class="docs"><div class="pilwrap"><a href="#section-1" class="pilcrow">&#182;</a></div><p>VIE autocomplete uses the VIE.find service method to make autocomplete suggestions.
The VIE.find method can query different backend or frontend data sources.
This demo goes to the default Apache Stanbol backend.</p>

<pre><code>var vie = new VIE();
vie.use(new vie.StanbolService({
    url : "http://dev.iks-project.eu:8081",
    proxyDisabled: true
}));

$('.search')
.vieAutocomplete({
    vie: vie,
    select: function(e, ui){
        console.log(ui);
    }
});
</code></pre>
</td><td class="code"><div class="highlight"><pre></pre></div></td></tr><tr id="section-2"><td class="docs"><div class="pilwrap"><a href="#section-2" class="pilcrow">&#182;</a></div><p>default VIE instance with stanbol service</p>
</td><td class="code"><div class="highlight"><pre><span class="nv">vie = </span><span class="k">new</span> <span class="nx">VIE</span><span class="p">()</span>
<span class="nx">vie</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="k">new</span> <span class="nx">vie</span><span class="p">.</span><span class="nx">StanbolService</span><span class="p">({</span>
    <span class="nv">url : </span><span class="s">&quot;http://dev.iks-project.eu:8080&quot;</span><span class="p">,</span>
    <span class="nv">proxyDisabled: </span><span class="kc">true</span>
<span class="p">}));</span>

<span class="nx">jQuery</span><span class="p">.</span><span class="nx">widget</span> <span class="s">&quot;IKS.vieAutocomplete&quot;</span><span class="p">,</span></pre></div></td></tr><tr id="section-3"><td class="docs"><div class="pilwrap"><a href="#section-3" class="pilcrow">&#182;</a></div><p>The widget <strong>options</strong> are:</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nv">options:</span></pre></div></td></tr><tr id="section-4"><td class="docs"><div class="pilwrap"><a href="#section-4" class="pilcrow">&#182;</a></div><ul>
<li>VIE instance.</li>
</ul>
</td><td class="code"><div class="highlight"><pre>        <span class="nv">vie: </span><span class="nx">vie</span></pre></div></td></tr><tr id="section-5"><td class="docs"><div class="pilwrap"><a href="#section-5" class="pilcrow">&#182;</a></div><ul>
<li>callback for selection event</li>
</ul>
</td><td class="code"><div class="highlight"><pre>        <span class="nv">select: </span><span class="nf">(e, ui) -&gt;</span>
        <span class="nv">urifield: </span><span class="kc">null</span></pre></div></td></tr><tr id="section-6"><td class="docs"><div class="pilwrap"><a href="#section-6" class="pilcrow">&#182;</a></div><ul>
<li>The field to search in.</li>
</ul>
</td><td class="code"><div class="highlight"><pre>        <span class="nv">field: </span><span class="s">&quot;rdfs:label&quot;</span></pre></div></td></tr><tr id="section-7"><td class="docs"><div class="pilwrap"><a href="#section-7" class="pilcrow">&#182;</a></div><ul>
<li>VIE service to use (right now only one)</li>
</ul>
</td><td class="code"><div class="highlight"><pre>        <span class="nv">services: </span><span class="s">&quot;stanbol&quot;</span>
        <span class="nv">debug: </span><span class="kc">false</span></pre></div></td></tr><tr id="section-8"><td class="docs"><div class="pilwrap"><a href="#section-8" class="pilcrow">&#182;</a></div><ul>
<li>Define Entity properties for finding depiction</li>
</ul>
</td><td class="code"><div class="highlight"><pre>        <span class="nv">showTooltip: </span><span class="kc">true</span>
        <span class="nv">depictionProperties: </span><span class="p">[</span>
          <span class="s">&quot;foaf:depiction&quot;</span>
          <span class="s">&quot;schema:thumbnail&quot;</span>
        <span class="p">]</span></pre></div></td></tr><tr id="section-9"><td class="docs"><div class="pilwrap"><a href="#section-9" class="pilcrow">&#182;</a></div><ul>
<li>Define Entity properties for finding the label</li>
</ul>
</td><td class="code"><div class="highlight"><pre>        <span class="nv">labelProperties: </span><span class="p">[</span>
          <span class="s">&quot;rdfs:label&quot;</span>
          <span class="s">&quot;skos:prefLabel&quot;</span>
          <span class="s">&quot;schema:name&quot;</span>
          <span class="s">&quot;foaf:name&quot;</span>
        <span class="p">]</span></pre></div></td></tr><tr id="section-10"><td class="docs"><div class="pilwrap"><a href="#section-10" class="pilcrow">&#182;</a></div><ul>
<li>Define Entity properties for finding the description</li>
</ul>
</td><td class="code"><div class="highlight"><pre>        <span class="nv">descriptionProperties: </span><span class="p">[</span>
          <span class="s">&quot;rdfs:comment&quot;</span>
          <span class="s">&quot;skos:note&quot;</span>
          <span class="s">&quot;schema:description&quot;</span>
          <span class="s">&quot;skos:definition&quot;</span>
            <span class="nv">property: </span><span class="s">&quot;skos:broader&quot;</span>
            <span class="nv">makeLabel: </span><span class="nf">(propertyValueArr) -&gt;</span>
              <span class="nv">labels = </span><span class="nx">_</span><span class="p">(</span><span class="nx">propertyValueArr</span><span class="p">).</span><span class="nx">map</span> <span class="nf">(termUri) -&gt;</span></pre></div></td></tr><tr id="section-11"><td class="docs"><div class="pilwrap"><a href="#section-11" class="pilcrow">&#182;</a></div><p>extract the last part of the uri</p>
</td><td class="code"><div class="highlight"><pre>                <span class="nx">termUri</span>
                <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;.*[\/#](.*)&gt;/</span><span class="p">,</span> <span class="s">&quot;$1&quot;</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">replace</span> <span class="sr">/_/g</span><span class="p">,</span> <span class="s">&quot;&amp;nbsp;&quot;</span>
              <span class="s">&quot;Subcategory of </span><span class="si">#{</span><span class="nx">labels</span><span class="p">.</span><span class="nx">join</span> <span class="s">&#39;, &#39;</span><span class="si">}</span><span class="s">.&quot;</span>
          <span class="p">,</span>
            <span class="nv">property: </span><span class="s">&quot;dcterms:subject&quot;</span>
            <span class="nv">makeLabel: </span><span class="nf">(propertyValueArr) -&gt;</span>
              <span class="nv">labels = </span><span class="nx">_</span><span class="p">(</span><span class="nx">propertyValueArr</span><span class="p">).</span><span class="nx">map</span> <span class="nf">(termUri) -&gt;</span></pre></div></td></tr><tr id="section-12"><td class="docs"><div class="pilwrap"><a href="#section-12" class="pilcrow">&#182;</a></div><p>extract the last part of the uri</p>
</td><td class="code"><div class="highlight"><pre>                <span class="nx">termUri</span>
                <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/&lt;.*[\/#](.*)&gt;/</span><span class="p">,</span> <span class="s">&quot;$1&quot;</span><span class="p">)</span>
                <span class="p">.</span><span class="nx">replace</span> <span class="sr">/_/g</span><span class="p">,</span> <span class="s">&quot;&amp;nbsp;&quot;</span>
              <span class="s">&quot;Subject(s): </span><span class="si">#{</span><span class="nx">labels</span><span class="p">.</span><span class="nx">join</span> <span class="s">&#39;, &#39;</span><span class="si">}</span><span class="s">.&quot;</span>
        <span class="p">]</span>
        <span class="nv">stanbolIncludeLocalSite: </span><span class="kc">false</span></pre></div></td></tr><tr id="section-13"><td class="docs"><div class="pilwrap"><a href="#section-13" class="pilcrow">&#182;</a></div><ul>
<li>If label and description is not available in the user's language 
look for a fallback.</li>
</ul>
</td><td class="code"><div class="highlight"><pre>        <span class="nv">fallbackLanguage: </span><span class="s">&quot;en&quot;</span>
        <span class="nv">styleClass: </span><span class="s">&quot;vie-autocomplete&quot;</span></pre></div></td></tr><tr id="section-14"><td class="docs"><div class="pilwrap"><a href="#section-14" class="pilcrow">&#182;</a></div><ul>
<li>type label definition</li>
</ul>
</td><td class="code"><div class="highlight"><pre>        <span class="nv">getTypes: </span><span class="o">-&gt;</span>
          <span class="p">[</span>
            <span class="nv">uri: </span>  <span class="s">&quot;</span><span class="si">#{</span><span class="nx">@ns</span><span class="p">.</span><span class="nx">dbpedia</span><span class="si">}</span><span class="s">Place&quot;</span>
            <span class="nv">label: </span><span class="s">&#39;Place&#39;</span>
          <span class="p">,</span>
            <span class="nv">uri: </span>  <span class="s">&quot;</span><span class="si">#{</span><span class="nx">@ns</span><span class="p">.</span><span class="nx">dbpedia</span><span class="si">}</span><span class="s">Person&quot;</span>
            <span class="nv">label: </span><span class="s">&#39;Person&#39;</span>
          <span class="p">,</span>
            <span class="nv">uri: </span>  <span class="s">&quot;</span><span class="si">#{</span><span class="nx">@ns</span><span class="p">.</span><span class="nx">dbpedia</span><span class="si">}</span><span class="s">Organisation&quot;</span>
            <span class="nv">label: </span><span class="s">&#39;Organisation&#39;</span>
          <span class="p">,</span>
            <span class="nv">uri: </span>  <span class="s">&quot;</span><span class="si">#{</span><span class="nx">@ns</span><span class="p">.</span><span class="nx">skos</span><span class="si">}</span><span class="s">Concept&quot;</span>
            <span class="nv">label: </span><span class="s">&#39;Concept&#39;</span>
          <span class="p">]</span></pre></div></td></tr><tr id="section-15"><td class="docs"><div class="pilwrap"><a href="#section-15" class="pilcrow">&#182;</a></div><ul>
<li>entity source label definition</li>
</ul>
</td><td class="code"><div class="highlight"><pre>        <span class="nv">getSources: </span><span class="o">-&gt;</span>
          <span class="p">[</span>
            <span class="nv">uri: </span><span class="s">&quot;http://dbpedia.org/resource/&quot;</span>
            <span class="nv">label: </span><span class="s">&quot;dbpedia&quot;</span>
          <span class="p">,</span>
            <span class="nv">uri: </span><span class="s">&quot;http://sws.geonames.org/&quot;</span>
            <span class="nv">label: </span><span class="s">&quot;geonames&quot;</span>
          <span class="p">]</span>
        <span class="nv">source: </span><span class="nf">(req, resp) -&gt;</span>
          <span class="nx">@_logger</span><span class="p">.</span><span class="nx">info</span> <span class="s">&quot;req:&quot;</span><span class="p">,</span> <span class="nx">req</span>
          <span class="nv">properties = </span><span class="nx">_</span><span class="p">.</span><span class="nx">flatten</span> <span class="p">[</span>
            <span class="nx">@options</span><span class="p">.</span><span class="nx">labelProperties</span>
            <span class="nx">@options</span><span class="p">.</span><span class="nx">descriptionProperties</span>
            <span class="nx">@options</span><span class="p">.</span><span class="nx">depictionProperties</span>
          <span class="p">]</span>
          <span class="nv">properties = </span><span class="nx">_</span><span class="p">(</span><span class="nx">properties</span><span class="p">).</span><span class="nx">map</span> <span class="nf">(prop) -&gt;</span>
            <span class="k">if</span> <span class="k">typeof</span> <span class="nx">prop</span> <span class="o">is</span> <span class="s">&quot;object&quot;</span>
              <span class="nx">prop</span><span class="p">.</span><span class="nx">property</span>
            <span class="k">else</span>
              <span class="nx">prop</span></pre></div></td></tr><tr id="section-16"><td class="docs"><div class="pilwrap"><a href="#section-16" class="pilcrow">&#182;</a></div><p>call VIE.find
if @options.stanbolIncludeLocalSite TODO implement multiple find requests and result merging</p>
</td><td class="code"><div class="highlight"><pre>          <span class="nv">waitingfor = </span><span class="mi">0</span>
          <span class="nv">mergedEntityList = </span><span class="p">[]</span>
          <span class="nv">success = </span><span class="p">(</span><span class="nx">entityList</span><span class="p">)</span> <span class="o">=&gt;</span>
            <span class="nx">_</span><span class="p">.</span><span class="nx">defer</span> <span class="o">=&gt;</span>
              <span class="nx">waitingfor</span><span class="o">--</span>
              <span class="nx">@_logger</span><span class="p">.</span><span class="nx">info</span> <span class="s">&quot;resp:&quot;</span><span class="p">,</span> <span class="nx">_</span><span class="p">(</span><span class="nx">entityList</span><span class="p">).</span><span class="nx">map</span> <span class="nf">(ent) -&gt;</span>
                <span class="nx">ent</span><span class="p">.</span><span class="nx">id</span>
              <span class="nv">limit = </span><span class="mi">10</span></pre></div></td></tr><tr id="section-17"><td class="docs"><div class="pilwrap"><a href="#section-17" class="pilcrow">&#182;</a></div><p>remove descriptive entity
TODO move to VIE</p>
</td><td class="code"><div class="highlight"><pre>              <span class="nv">entityList = </span><span class="nx">_</span><span class="p">(</span><span class="nx">entityList</span><span class="p">).</span><span class="nx">filter</span> <span class="nf">(ent) -&gt;</span>
                <span class="k">return</span> <span class="kc">false</span> <span class="k">if</span> <span class="nx">ent</span><span class="p">.</span><span class="nx">getSubject</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/^&lt;|&gt;$/g</span><span class="p">,</span> <span class="s">&quot;&quot;</span><span class="p">)</span> <span class="o">is</span> <span class="s">&quot;http://www.iks-project.eu/ontology/rick/query/QueryResultSet&quot;</span>
                <span class="k">return</span> <span class="kc">true</span>
              <span class="nv">mergedEntityList = </span><span class="nx">mergedEntityList</span><span class="p">.</span><span class="nx">concat</span> <span class="nx">entityList</span>
              <span class="k">if</span> <span class="nx">waitingfor</span> <span class="o">is</span> <span class="mi">0</span></pre></div></td></tr><tr id="section-18"><td class="docs"><div class="pilwrap"><a href="#section-18" class="pilcrow">&#182;</a></div><p>Sort by score</p>
</td><td class="code"><div class="highlight"><pre>                <span class="nv">mergedEntityList = </span><span class="nx">_</span><span class="p">.</span><span class="nx">sortBy</span> <span class="nx">mergedEntityList</span><span class="p">,</span> <span class="nf">(e) -&gt;</span>
                  <span class="nv">s = </span><span class="nx">e</span><span class="p">.</span><span class="nx">get</span> <span class="s">&#39;&lt;http://stanbol.apache.org/ontology/entityhub/query#score&gt;&#39;</span>
                  <span class="k">if</span> <span class="k">typeof</span> <span class="nx">s</span> <span class="o">is</span> <span class="s">&quot;object&quot;</span>
                    <span class="nv">s = </span><span class="nx">_</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">s</span><span class="p">)</span>
                  <span class="k">return</span> <span class="mi">0</span> <span class="o">-</span> <span class="nx">s</span>
                <span class="nx">@_logger</span><span class="p">.</span><span class="nx">info</span> <span class="nx">_</span><span class="p">(</span><span class="nx">mergedEntityList</span><span class="p">).</span><span class="nx">map</span> <span class="nf">(e) -&gt;</span>
                  <span class="nv">uri = </span><span class="nx">e</span><span class="p">.</span><span class="nx">getSubject</span><span class="p">()</span>
                  <span class="nv">s = </span><span class="nx">e</span><span class="p">.</span><span class="nx">get</span> <span class="s">&#39;&lt;http://stanbol.apache.org/ontology/entityhub/query#score&gt;&#39;</span>
                  <span class="k">return</span> <span class="s">&quot;</span><span class="si">#{</span><span class="nx">uri</span><span class="si">}</span><span class="s">: </span><span class="si">#{</span><span class="nx">s</span><span class="si">}</span><span class="s">&quot;</span>
                <span class="nv">res = </span><span class="nx">_</span><span class="p">(</span><span class="nx">mergedEntityList</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">limit</span><span class="p">)).</span><span class="nx">map</span> <span class="p">(</span><span class="nx">entity</span><span class="p">)</span> <span class="o">=&gt;</span>
                  <span class="k">return</span> <span class="p">{</span>
                  <span class="nv">key: </span><span class="nx">entity</span><span class="p">.</span><span class="nx">getSubject</span><span class="p">().</span><span class="nx">replace</span> <span class="sr">/^&lt;|&gt;$/g</span><span class="p">,</span> <span class="s">&quot;&quot;</span>
                  <span class="nv">label: </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">@_getLabel</span> <span class="nx">entity</span><span class="si">}</span><span class="s"> @ </span><span class="si">#{</span><span class="nx">@_sourceLabel</span> <span class="nx">entity</span><span class="p">.</span><span class="nx">id</span><span class="si">}</span><span class="s">&quot;</span>
                  <span class="nv">value: </span><span class="nx">@_getLabel</span> <span class="nx">entity</span>
                  <span class="nv">getUri: </span><span class="o">-&gt;</span>
                    <span class="nx">@key</span>
                  <span class="p">}</span>
                <span class="nx">resp</span> <span class="nx">res</span>

          <span class="nx">waitingfor</span><span class="o">++</span>
          <span class="nx">@options</span><span class="p">.</span><span class="nx">vie</span>
          <span class="p">.</span><span class="nx">find</span><span class="p">({</span>
            <span class="nv">term: </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">req</span><span class="p">.</span><span class="nx">term</span><span class="si">}#{</span><span class="k">if</span> <span class="nx">req</span><span class="p">.</span><span class="nx">term</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="k">then</span> <span class="s">&#39;*&#39;</span>  <span class="k">else</span> <span class="s">&#39;&#39;</span><span class="si">}</span><span class="s">&quot;</span>
            <span class="nv">field: </span><span class="nx">@options</span><span class="p">.</span><span class="nx">field</span>
            <span class="nv">properties: </span><span class="nx">properties</span>
          <span class="p">})</span>
          <span class="p">.</span><span class="nx">using</span><span class="p">(</span><span class="nx">@options</span><span class="p">.</span><span class="nx">services</span><span class="p">).</span><span class="nx">execute</span><span class="p">()</span></pre></div></td></tr><tr id="section-19"><td class="docs"><div class="pilwrap"><a href="#section-19" class="pilcrow">&#182;</a></div><p>error handling</p>
</td><td class="code"><div class="highlight"><pre>          <span class="p">.</span><span class="nx">fail</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span>
            <span class="nx">@_logger</span><span class="p">.</span><span class="nx">error</span> <span class="s">&quot;Something wrong happened at stanbol find:&quot;</span><span class="p">,</span> <span class="nx">e</span>
          <span class="p">.</span><span class="nx">success</span> <span class="nx">success</span>

          <span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">stanbolIncludeLocalSite</span>
            <span class="nx">@_logger</span><span class="p">.</span><span class="nx">log</span> <span class="s">&quot;stanbolIncludeLocalSite&quot;</span>
            <span class="nx">waitingfor</span><span class="o">++</span>
            <span class="nx">@options</span><span class="p">.</span><span class="nx">vie</span>
            <span class="p">.</span><span class="nx">find</span><span class="p">({</span>
              <span class="nv">term: </span><span class="s">&quot;</span><span class="si">#{</span><span class="nx">req</span><span class="p">.</span><span class="nx">term</span><span class="si">}#{</span><span class="k">if</span> <span class="nx">req</span><span class="p">.</span><span class="nx">term</span><span class="p">.</span><span class="nx">length</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="k">then</span> <span class="s">&#39;*&#39;</span>  <span class="k">else</span> <span class="s">&#39;&#39;</span><span class="si">}</span><span class="s">&quot;</span>
              <span class="nv">field: </span><span class="nx">@options</span><span class="p">.</span><span class="nx">field</span>
              <span class="nv">properties: </span><span class="nx">properties</span>
              <span class="nv">local: </span><span class="kc">true</span>
            <span class="p">})</span>
            <span class="p">.</span><span class="nx">using</span><span class="p">(</span><span class="nx">@options</span><span class="p">.</span><span class="nx">services</span><span class="p">).</span><span class="nx">execute</span><span class="p">()</span></pre></div></td></tr><tr id="section-20"><td class="docs"><div class="pilwrap"><a href="#section-20" class="pilcrow">&#182;</a></div><p>error handling</p>
</td><td class="code"><div class="highlight"><pre>            <span class="p">.</span><span class="nx">fail</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span>
              <span class="nx">@_logger</span><span class="p">.</span><span class="nx">error</span> <span class="s">&quot;Something wrong happened at stanbol find:&quot;</span><span class="p">,</span> <span class="nx">e</span>
            <span class="p">.</span><span class="nx">success</span> <span class="nx">success</span>
    <span class="nv">_create: </span><span class="o">-&gt;</span>
      <span class="vi">@_logger = </span><span class="k">if</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">debug</span> <span class="k">then</span> <span class="nx">console</span> <span class="k">else</span>
        <span class="nv">info: </span><span class="o">-&gt;</span>
        <span class="nv">warn: </span><span class="o">-&gt;</span>
        <span class="nv">error: </span><span class="o">-&gt;</span>
        <span class="nv">log: </span><span class="o">-&gt;</span>
      <span class="vi">@menuContainer = </span><span class="nx">jQuery</span> <span class="s">&quot;&lt;span class=&#39;</span><span class="si">#{</span><span class="nx">@options</span><span class="p">.</span><span class="nx">styleClass</span><span class="si">}</span><span class="s">&#39;/&gt;&quot;</span>
      <span class="nx">@menuContainer</span><span class="p">.</span><span class="nx">appendTo</span> <span class="s">&#39;body&#39;</span>
      <span class="nx">@_instantiateAutocomplete</span><span class="p">()</span>

    <span class="nv">_destroy: </span><span class="o">-&gt;</span>
      <span class="nx">@menuContainer</span><span class="p">.</span><span class="nx">remove</span><span class="p">()</span>
    <span class="nv">_instantiateAutocomplete: </span><span class="o">-&gt;</span>
      <span class="nv">widget = </span><span class="nx">@</span>
      <span class="nx">@element</span>
      <span class="p">.</span><span class="nx">autocomplete</span></pre></div></td></tr><tr id="section-21"><td class="docs"><div class="pilwrap"><a href="#section-21" class="pilcrow">&#182;</a></div><p>define where do suggestions come from</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nv">source: </span><span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">resp</span><span class="p">)</span> <span class="o">=&gt;</span>
          <span class="nx">@options</span><span class="p">.</span><span class="nx">source</span><span class="p">.</span><span class="nx">apply</span> <span class="nx">@</span><span class="p">,</span> <span class="p">[</span><span class="nx">req</span><span class="p">,</span> <span class="nx">resp</span><span class="p">]</span></pre></div></td></tr><tr id="section-22"><td class="docs"><div class="pilwrap"><a href="#section-22" class="pilcrow">&#182;</a></div><p>create tooltip on menu elements when menu opens</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nv">open: </span><span class="nf">(e, ui) -&gt;</span>
          <span class="nx">widget</span><span class="p">.</span><span class="nx">_logger</span><span class="p">.</span><span class="nx">info</span> <span class="s">&quot;autocomplete.open&quot;</span><span class="p">,</span> <span class="nx">e</span><span class="p">,</span> <span class="nx">ui</span>
          <span class="k">if</span> <span class="nx">widget</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">showTooltip</span>
            <span class="nx">$</span><span class="p">(</span><span class="s">&#39;.ui-menu-item&#39;</span><span class="p">,</span> <span class="nx">$</span><span class="p">(</span><span class="k">this</span><span class="p">).</span><span class="nx">data</span><span class="p">().</span><span class="nx">autocomplete</span><span class="p">.</span><span class="nx">menu</span><span class="p">.</span><span class="nx">activeMenu</span><span class="p">)</span>
            <span class="p">.</span><span class="nx">each</span> <span class="o">-&gt;</span>
              <span class="nv">item = </span><span class="nx">$</span><span class="p">(</span> <span class="nx">@</span> <span class="p">).</span><span class="nx">data</span><span class="p">()[</span><span class="s">&quot;item.autocomplete&quot;</span><span class="p">]</span> <span class="o">or</span> <span class="nx">$</span><span class="p">(</span> <span class="nx">@</span> <span class="p">).</span><span class="nx">data</span><span class="p">()[</span><span class="s">&quot;uiAutocompleteItem&quot;</span><span class="p">]</span> <span class="o">or</span> <span class="nx">$</span><span class="p">(</span> <span class="nx">@</span> <span class="p">).</span><span class="nx">data</span><span class="p">()[</span><span class="s">&quot;ui-autocomplete-item&quot;</span><span class="p">]</span>
              <span class="nv">uri = </span><span class="nx">item</span><span class="p">.</span><span class="nx">getUri</span><span class="p">()</span>
              <span class="nx">$</span><span class="p">(</span><span class="nx">@</span><span class="p">).</span><span class="nx">entitypreview</span>
                <span class="nv">vie: </span><span class="nx">widget</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">vie</span>
                <span class="nv">uri: </span><span class="nx">uri</span>
            <span class="p">.</span><span class="nx">first</span><span class="p">().</span><span class="nx">parent</span><span class="p">().</span><span class="nx">bind</span> <span class="s">&#39;menufocus&#39;</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">ui</span><span class="p">)</span> <span class="o">=&gt;</span>
              <span class="nx">console</span><span class="p">.</span><span class="nx">info</span> <span class="s">&#39;fire focusin&#39;</span>
              <span class="nx">ui</span><span class="p">.</span><span class="nx">item</span><span class="p">.</span><span class="nx">trigger</span><span class="p">(</span><span class="s">&#39;focusin&#39;</span><span class="p">,</span> <span class="nx">ui</span><span class="p">)</span>

        <span class="nv">focus: </span><span class="nf">(e, ui) -&gt;</span>
          <span class="nx">console</span><span class="p">.</span><span class="nx">info</span> <span class="s">&quot;focus&quot;</span><span class="p">,</span> <span class="nx">ui</span></pre></div></td></tr><tr id="section-23"><td class="docs"><div class="pilwrap"><a href="#section-23" class="pilcrow">&#182;</a></div><p>An entity selected, annotate</p>
</td><td class="code"><div class="highlight"><pre>        <span class="nv">select: </span><span class="p">(</span><span class="nx">e</span><span class="p">,</span> <span class="nx">ui</span><span class="p">)</span> <span class="o">=&gt;</span>
          <span class="nx">$</span><span class="p">(</span><span class="s">&#39;.ui-menu-item&#39;</span><span class="p">,</span> <span class="nx">$</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">).</span><span class="nx">data</span><span class="p">().</span><span class="nx">autocomplete</span><span class="p">.</span><span class="nx">menu</span><span class="p">.</span><span class="nx">activeMenu</span><span class="p">).</span><span class="nx">each</span> <span class="o">-&gt;</span>
            <span class="nx">$</span><span class="p">(</span><span class="nx">@</span><span class="p">)</span></pre></div></td></tr><tr id="section-24"><td class="docs"><div class="pilwrap"><a href="#section-24" class="pilcrow">&#182;</a></div><p>.entitypreview('hide')</p>
</td><td class="code"><div class="highlight"><pre>            <span class="p">.</span><span class="nx">entitypreview</span><span class="p">(</span><span class="s">&#39;destroy&#39;</span><span class="p">)</span>
          <span class="nx">_</span><span class="p">.</span><span class="nx">defer</span> <span class="o">=&gt;</span>
            <span class="nx">@options</span><span class="p">.</span><span class="nx">select</span> <span class="nx">e</span><span class="p">,</span> <span class="nx">ui</span>
            <span class="nx">@_logger</span><span class="p">.</span><span class="nx">info</span> <span class="s">&quot;autocomplete.select&quot;</span><span class="p">,</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">,</span> <span class="nx">ui</span>
            <span class="k">if</span> <span class="nx">widget</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">urifield</span>
              <span class="nx">widget</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">urifield</span><span class="p">.</span><span class="nx">val</span> <span class="nx">ui</span><span class="p">.</span><span class="nx">item</span><span class="p">.</span><span class="nx">key</span>
          <span class="kc">true</span>
        <span class="nv">appendTo: </span><span class="nx">@menuContainer</span>
    <span class="nv">_getUserLang: </span><span class="o">-&gt;</span>
      <span class="nb">window</span><span class="p">.</span><span class="nx">navigator</span><span class="p">.</span><span class="nx">language</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s">&quot;-&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

    <span class="nv">_getLabel: </span><span class="nf">(entity) -&gt;</span>
      <span class="nv">preferredFields = </span><span class="nx">@options</span><span class="p">.</span><span class="nx">labelProperties</span>
      <span class="nv">preferredLanguages = </span><span class="p">[</span><span class="nx">@_getUserLang</span><span class="p">(),</span> <span class="nx">@options</span><span class="p">.</span><span class="nx">fallbackLanguage</span><span class="p">]</span>
      <span class="nx">VIE</span><span class="p">.</span><span class="nx">Util</span><span class="p">.</span><span class="nx">getPreferredLangForPreferredProperty</span> <span class="nx">entity</span><span class="p">,</span> <span class="nx">preferredFields</span><span class="p">,</span> <span class="nx">preferredLanguages</span></pre></div></td></tr><tr id="section-25"><td class="docs"><div class="pilwrap"><a href="#section-25" class="pilcrow">&#182;</a></div><p>make a label for the entity source based on options.getSources()</p>
</td><td class="code"><div class="highlight"><pre>    <span class="nv">_sourceLabel: </span><span class="nf">(src) -&gt;</span>
      <span class="nx">@_logger</span><span class="p">.</span><span class="nx">warn</span> <span class="s">&quot;No source&quot;</span> <span class="nx">unless</span> <span class="nx">src</span>
      <span class="k">return</span> <span class="s">&quot;&quot;</span> <span class="nx">unless</span> <span class="nx">src</span>
      <span class="nv">sources = </span><span class="nx">@options</span><span class="p">.</span><span class="nx">getSources</span><span class="p">()</span>
      <span class="nv">sourceObj = </span><span class="nx">_</span><span class="p">(</span><span class="nx">sources</span><span class="p">).</span><span class="nx">detect</span> <span class="nf">(s) -&gt;</span> <span class="nx">src</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">s</span><span class="p">.</span><span class="nx">uri</span><span class="p">)</span> <span class="o">isnt</span> <span class="o">-</span><span class="mi">1</span>
      <span class="k">if</span> <span class="nx">sourceObj</span>
        <span class="nx">sourceObj</span><span class="p">.</span><span class="nx">label</span>
      <span class="k">else</span>
        <span class="nx">src</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s">&quot;/&quot;</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span>

</pre></div></td></tr></tbody></table><div id="generated">generated Mon Dec 17 2012 17:33:24 GMT+0100 (CET)  </div></div></body></html>